<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON –ü–∞—Ä—Å–µ—Ä | IAppsRepo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --font: 'Inter', -apple-system, sans-serif; }
        [data-theme="dark"] {
            --bg: #0a0a0f; --bg-card: rgba(26,26,36,0.9); --border: rgba(255,255,255,0.08);
            --text: #fff; --text-muted: rgba(255,255,255,0.5); --accent: #6366f1;
        }
        [data-theme="light"] {
            --bg: #f8fafc; --bg-card: rgba(255,255,255,0.95); --border: rgba(0,0,0,0.08);
            --text: #0f172a; --text-muted: #64748b; --accent: #6366f1;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: clamp(1rem, 5vw, 3rem);
            transition: all 0.3s;
        }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; }
        .back { display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted); font-weight: 500; transition: color 0.2s; }
        .back:hover { color: var(--accent); }
        .back svg { fill: currentColor; }
        .theme-btn {
            width: 44px; height: 44px; border-radius: 12px; background: var(--bg-card);
            border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; cursor: pointer; transition: all 0.2s;
        }
        .theme-btn:hover { border-color: var(--accent); }
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 400px), 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(20px);
        }
        .card__title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; text-align: center; }
        .btn {
            display: flex; align-items: center; justify-content: center; width: 100%;
            padding: 1rem; font-size: 1rem; font-weight: 600; border-radius: 12px;
            background: linear-gradient(135deg, #6366f1, #a855f7); color: #fff;
            cursor: pointer; transition: all 0.2s; margin-bottom: 1rem; position: relative; overflow: hidden;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(99,102,241,0.4); }
        .btn:last-child { margin-bottom: 0; }
        .btn input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .json-box {
            display: none; background: var(--bg); border: 1px solid var(--border); border-radius: 12px;
            padding: 1rem; max-height: 50vh; overflow: auto; font-family: 'SF Mono', monospace;
            font-size: 0.8125rem; line-height: 1.7; white-space: pre-wrap; word-break: break-word;
        }
        .json-box.active { display: block; }
        .json-key { color: #f472b6; }
        .json-string { color: #a5d6ff; }
        .json-boolean { color: #c4b5fd; }
        .json-number { color: #86efac; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    </style>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back">
            <svg width="20" height="20" viewBox="0 0 24 24"><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z"/></svg>
            –ù–∞–∑–∞–¥
        </a>
        <button class="theme-btn" id="themeBtn">üåô</button>
    </div>

    <div class="container">
        <div class="card">
            <h2 class="card__title">üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ JSON</h2>
            <button class="btn">
                –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                <input type="file" id="fileInput" accept=".json">
            </button>
            <button class="btn" id="parseBtn">‚¨áÔ∏è –ü–∞—Ä—Å–∏—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å</button>
        </div>
        <div class="card">
            <h2 class="card__title">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
            <pre class="json-box" id="jsonBox"></pre>
        </div>
    </div>

    <script>
        // Theme
        const html = document.documentElement;
        const themeBtn = document.getElementById('themeBtn');
        const saved = localStorage.getItem('theme') || 'dark';
        html.dataset.theme = saved;
        themeBtn.textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        
        themeBtn.onclick = () => {
            const next = html.dataset.theme === 'dark' ? 'light' : 'dark';
            html.dataset.theme = next;
            localStorage.setItem('theme', next);
            themeBtn.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        };

        // JSON Parser
        let jsonData = null;
        const fileInput = document.getElementById('fileInput');
        const parseBtn = document.getElementById('parseBtn');
        const jsonBox = document.getElementById('jsonBox');

        fileInput.onchange = function() {
            const file = this.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    jsonData = JSON.parse(reader.result);
                    jsonBox.innerHTML = highlight(JSON.stringify(jsonData, null, 2));
                    jsonBox.classList.add('active');
                } catch { alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON'); }
            };
            reader.readAsText(file);
        };

        function highlight(json) {
            return json.replace(
                /("(\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,
                m => {
                    let c = 'json-number';
                    if (/^"/.test(m)) c = /:$/.test(m) ? 'json-key' : 'json-string';
                    else if (/true|false/.test(m)) c = 'json-boolean';
                    return `<span class="${c}">${m}</span>`;
                }
            );
        }

        parseBtn.onclick = () => {
            if (!jsonData?.appRepositories) return alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Å –ø–æ–ª–µ–º appRepositories');
            const data = jsonData.appRepositories.map(a => ({
                appName: a.appName, appImage: a.appImage, appVersion: a.appVersion,
                appDescription: a.appDescription, appUpdateTime: a.appUpdateTime
            }));
            const blob = new Blob([JSON.stringify(data, null, 4)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'Repo.json';
            a.click();
        };
    </script>
</body>
</html>